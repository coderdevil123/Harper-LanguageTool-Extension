console.log("Background loaded üöÄ");let c={grammar:[],harper:{tone:[],terminology:[]}};chrome.runtime.onMessage.addListener((t,a,r)=>{var u,n;const o=(u=a==null?void 0:a.tab)==null?void 0:u.id;if(!a.tab)switch(console.log("Popup message received:",t.type),t.type){case"PING":return r({status:"active"}),!0;case"GET_LAST_RESULTS":return r({success:!0,data:c}),!0;case"REQUEST_REFRESH":return r({success:!0,data:c}),!0;case"APPLY_SUGGESTION":return chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]?(chrome.tabs.sendMessage(e[0].id,{type:"APPLY_SUGGESTION",payload:t.payload}),r({success:!0})):r({success:!1,error:"No active tab"})}),!0;case"TOGGLE_EXTENSION":return r({success:!0}),!0;default:return console.warn("Unknown popup message type:",t.type),r({success:!1,error:"Unknown message type"}),!0}if(t.type==="USER_TEXT")return i(t.payload.text).then(e=>{c=e,chrome.tabs.sendMessage(o,{type:"COMBINED_RESULTS",payload:e})}),r(!0),!0;if(t.type==="GET_SUGGESTIONS"){const e=t.payload.issue;let s=[];return e.replacements&&(s=e.replacements.map(l=>l.value)),e.suggestions&&(s=e.suggestions),chrome.tabs.sendMessage(o,{type:"SHOW_SUGGESTIONS",payload:{text:e.text||((n=e.context)==null?void 0:n.text),suggestions:s,position:t.payload.position}}),r(!0),!0}if(t.type==="APPLY_SUGGESTION")return chrome.tabs.sendMessage(o,{type:"APPLY_SUGGESTION",payload:{replacement:t.payload.replacement}}),r(!0),!0});async function i(t){return{grammar:await p(t),harper:{tone:[],terminology:[]}}}async function p(t){try{const a=await fetch("http://10.10.10.36:8081/v2/check",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({text:t,language:"en-US"})});if(!a.ok)throw new Error(`LT server responded with ${a.status}`);return(await a.json()).matches||[]}catch(a){return console.error("LanguageTool error:",a),console.warn("‚ö†Ô∏è LanguageTool server not available at http://10.10.10.36:8081"),[]}}
